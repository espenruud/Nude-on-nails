<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src='lib/quintus.js'></script>
    <script src='lib/quintus_sprites.js'></script>
    <script src='lib/quintus_scenes.js'></script>
    <script src='lib/quintus_input.js'></script>
    <script src='lib/quintus_anim.js'></script>
    <script src='lib/quintus_2d.js'></script>
    <script src='lib/quintus_touch.js'></script>
    <script src='lib/quintus_ui.js'></script>
</head>
<body style="background-color: black;">
    <script>
        var Q = Quintus({development: true})
        .include("Sprites, Scenes, Input, 2D, Touch, UI")
        .setup({
            width: 960,
            height: 640
        }).controls().touch();

        Q.Sprite.extend("Player",{
            init: function(p) {
              this._super(p, { asset: "player.png", x: 110, y: 50, jumpSpeed: -380});
              this.add('2d, platformerControls');              
          },
          step: function(dt) {
            if(Q.inputs['left'] && this.p.direction == 'right') {
                this.p.flip = 'x';
            } 
            if(Q.inputs['right']  && this.p.direction == 'left') {
                this.p.flip = false;                    
            }
        }                    
    });

        Q.Sprite.extend("Spring",{

            init: function(p) {
                this._super(p,{
                    sheet: "SheetSpringboard",
                    frame: 1
                });

              this.add("2d");

              this.on("bump.top,bump.left,bump.right,bump.bottom",function(collision) {
                if(collision.obj.isA("Player")) { 
                    collision.obj.p.vy = -800;
                    this.sheet.frame = 1;

                } 
            }); 
          },
          step : function (dt) {

          } 
      });

        Q.Sprite.extend("Enemy",{
          init: function(p) {
            this._super(p, { sheet: 'enemy', vx: 100 });
            this.add('2d, aiBounce');
            
            this.on("bump.left,bump.right,bump.bottom",function(collision) {
              if(collision.obj.isA("Player")) { 
                Q.stageScene("endGame",1, { label: "You Died" }); 
                collision.obj.destroy();
              }
            });
            
            this.on("bump.top",function(collision) {
              if(collision.obj.isA("Player")) { 
                this.destroy();
                collision.obj.p.vy = -300;
              }
            });
          }
        });


            //load assets
            Q.load("tiles_map.png, player.png, level1.tmx, springboard.png, sprites.png", function() {
              Q.sheet("tiles","tiles_map.png", { tilew: 70, tileh: 70});          
              Q.stageScene("level1");
              Q.sheet("SheetSpringboard",
                "springboard.png",
                {
                    tilew: 70,
                    tileh: 70
                }
                );

                Q.sheet("enemy", "sprites.png",{tilew: 30, tileh: 30 });
          });



            Q.scene("level1",function(stage) {          
                var background = new Q.TileLayer({ dataAsset: 'level1.tmx', layerIndex: 0, sheet: 'tiles', tileW: 70, tileH: 70, type: Q.SPRITE_NONE });

                stage.insert(background);

                stage.collisionLayer(new Q.TileLayer({ dataAsset: 'level1.tmx', layerIndex:1,  sheet: 'tiles', tileW: 70, tileH: 70 }));

                var player = stage.insert(new Q.Player());

                stage.insert(new Q.Enemy({ x: 400, y: 400 }));
                
                stage.add("viewport").follow(player,{x: true, y: true},{minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h});

                stage.insert(new Q.Spring({ 
                    sheet: "SheetSpringboard",
                    frame: 0,
                    x: 130, 
                    y: 590,
                    w: 70,
                    h: 70
                }));

                stage.insert(new Q.Spring({ 
                    sheet: "SheetSpringboard",
                    frame: 0,
                    x: 250, 
                    y: 200,
                    w: 70,
                    h: 70
                }));
                stage.insert(new Q.Spring({ 
                    sheet: "SheetSpringboard",
                    frame: 0,
                    x: 1400, 
                    y: 200,
                    w: 70,
                    h: 70
                }));  
            });

        </script>
    </body>
    </html>